name: Create Branch and Pull Request

on:
  workflow_dispatch:
    inputs:
      pr-title:
        description: 'Pull request title'
        required: false
        default: 'Update README.md'

jobs:
  create-branch-and-pr:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v6

      - name: Generate random branch name
        id: branch-gen
        run: |
          RANDOM_NAME="auto-$(date +%s)-$RANDOM"
          echo "name=$RANDOM_NAME" >> $GITHUB_OUTPUT

      - name: Update README.md
        run: |
          echo "" >> README.md
          echo "---" >> README.md
          echo "" >> README.md
          echo "**Last Updated:** $(date)" >> README.md
          echo "" >> README.md
          echo "_Updated by GitHub Actions Bot_" >> README.md

      - name: Create Pull Request
        id: cpr
        uses: peter-evans/create-pull-request@v7
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: 'docs: update README.md'
          committer: github-actions[bot] <41898282+github-actions[bot]@users.noreply.github.com>
          author: github-actions[bot] <41898282+github-actions[bot]@users.noreply.github.com>
          branch: feature/${{ steps.branch-gen.outputs.name }}
          delete-branch: true
          title: ${{ inputs.pr-title }}
          body: |
            ## Automated README Update
            
            README.md automatically updated by workflow.
            
            **Branch:** feature/${{ steps.branch-gen.outputs.name }}
            **Triggered by:** @${{ github.actor }}
          labels: |
            documentation
            automated
          draft: false

      - name: PR Details
        if: ${{ steps.cpr.outputs.pull-request-number }}
        run: |
          echo "âœ… Pull Request Created!"
          echo "PR #${{ steps.cpr.outputs.pull-request-number }}"
          echo "URL: ${{ steps.cpr.outputs.pull-request-url }}"
